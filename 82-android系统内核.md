# 8.2 Android系统内核

Android采用Linux内核，与Linux内核的一些特性有着重要的关系。比如：

* 强大的内存管理和进程管理方案。

* 基于权限的安全模式

* 支持共享库

* 经过认证的驱动模型

* Linux本身就是开源项目


但Android系统与Linux之间还是存在很大差别的，本节将分别介绍下Linux内核与Android内核的特点。

## 8.2.1 Linux内核结构

Linux内核主要由五个子系统组成：进程调度，内存管理，虚拟文件系统，网络接口，进程间通信。

![](/assets/8.2.1.png)

* 进程调度（SCHED）

进程调度负责创建和销毁进程，控制系统中的多个进程对CPU的访问，使得多个进程能在CPU中“微观串行，宏观并行”地执行。每个子系统都需要挂起或修复进程，因此进程调度处于系统中的中心位置。内核中的其他子系统都依赖它。概括来说，进程调度就是在单个或多个CPU上实现了多个进程的抽象。

* 内存管理（MM）

内存是计算机的主要资源之一，用来管理内存的策略是决定系统性能的一个关键因素。内存管理的主要作用是控制多个进程安全地共享主内存区域。Linux的内存管理支持虚拟内存，即在计算机中运行的程序，其代码、数据、堆栈的总量可以超过实际内存的大小，操作系统只是把当前使用的程序块保留在内存中，其余的程序块则保留在磁盘中。内核在有限的可用资源之上为每个进程都创建了一个虚拟地址空间，Linux内存管理完成为每个进程进行虚拟内存到物理内存的转换。

* 虚拟文件系统（VirtualFileSystem, VFS）

Linux中的每个对象都可以当作文件来看待。内核在没有结构的硬件上构造结构化的文件系统，而文件抽象在整个系统中广泛使用。虚拟文件系统隐藏了各种硬件的具体细节，为所有的设备提供了统一的接口。它独立于各个具体的文件系统，是对各个文件系统的一个抽象。虚拟文件系统可以分为逻辑文件系统和设备驱动程序。逻辑文件系统指Linux所支持的文件系统，如ext3、FAT等，设备驱动的程序指为每一种硬件控制器所编写的设备驱动程序模块。

* 网络接口（NET）

网络接口提供了对各种网络标准的存取和各种网络硬件的支持。在Linux中，网络接口可分为网络协议和网络驱动程序，网络协议部分负责实现每一种可能的网络传输协议，网络设备驱动程序负责与硬件设备通信，每一种可能的硬件设备都有相应的设备驱动程序。

* 进程通信（IPC）

进程通信支持提供进程之间的通信，不同进程之间的通信（通过信号、管道或进程间通信原语）是整个系统的基本功能。Linux支持进程间的多种通信机制，包含信号量、共享内存、管道等，这些机制可协助多个进程、多资源的互斥访问、进程间的同步和消息传递。

## 8.2.2 Android内核和驱动

Android在Linux内核的基础上进行了增强，增加了一些面向移动计算的特有功能。例如，低内存管理器LMK（Low Memory Killer）、匿名共享内存（Ashmem），以及轻量级的进程间通信Binder进制等。这些内核的增强使Android在继承Linux内核安全机制的同时，进一步提升了内存管理、进程间通信等方面的安全性。

* 显示驱动（Display Driver）

基于Linux的帧缓冲（FrameBuffer）驱动。

* 照相机驱动（Camera Driver）

基于Linux的V4L2（Video for Linux）驱动。

* 蓝牙驱动（Bluetooth Driver）

基于IEEE 802.15.1标准的无线传输技术。

* Flash 内存驱动（Flash Memory Driver）

基于MTD的Flash驱动程序。

* Binder\(IPC\) Driver

Android采用的一种进程间通信机制，通过共享内存来提高性能，为进程请求分配每个进程的线程池。

* USB驱动（USB Driver）

提供USB设备的连接支持。

* 键盘驱动（Keypad Driver）

为输入设备提供支持。

* WiFi驱动（WiFi Driver）

基于IEEE 802.11标准的驱动程序。

* 音频驱动（Audio Drivers）

基于ALSA（Advanced Linux Sound Architecture）的高级Linux声音体系驱动。

* 电源管理（Power Management）

对电池电量进行监控。

